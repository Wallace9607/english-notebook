<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dicion√°rio + Treino de Pron√∫ncia</title>
<style>
:root{
  --bg:#0f172a; --panel:#0b1220; --panel2:#111827; --text:#e5e7eb; --muted:#94a3b8;
  --accent:#38bdf8; --accent2:#22d3ee; --ok:#16a34a; --err:#ef4444;
}
*{box-sizing:border-box}
html,body{height:100%; margin:0; font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, Helvetica, Arial; background:
  radial-gradient(1200px 600px at 10% -10%, rgba(56,189,248,.15), transparent 60%),
  radial-gradient(1000px 600px at 90% 0%, rgba(34,211,238,.10), transparent 60%),
  linear-gradient(180deg, var(--bg), #060b16 40%, #050a14 100%); padding:32px 16px;}
.wrap{max-width:1000px;margin:0 auto}
header{text-align:center;margin-bottom:24px}
h1{margin:0;font-size:clamp(28px,5vw,42px);background:linear-gradient(90deg,var(--accent),var(--accent2));-webkit-background-clip:text;color:transparent}
.subtitle{color:var(--muted);font-size:16px;max-width:65ch;margin:8px auto 16px}

form{display:flex; gap:8px; justify-content:center; flex-wrap:wrap; margin-bottom:24px}
form input{padding:8px 12px; border-radius:10px; border:1px solid rgba(148,163,184,.22); background:#0c1426; color:var(--text)}
form button{background:#0ea5a4;border:0;color:#032;padding:10px 14px;border-radius:10px;font-weight:700;cursor:pointer}

.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:16px}

.phrase-card{background:linear-gradient(180deg, var(--panel2), rgba(15,23,42,.7)); border:1px solid rgba(148,163,184,.12); border-radius:12px; padding:16px; display:flex; flex-direction:column; align-items:center; justify-content:center; transition:transform .18s ease, box-shadow .18s ease}
.phrase-card:hover{transform:translateY(-3px); box-shadow:0 0 0 1px rgba(34,211,238,.30), 0 15px 35px -10px rgba(34,211,238,.40)}
.phrase-card span{font-size:16px;font-weight:700;color:var(--accent); text-align:center;}
.phrase-card small{color:var(--muted);margin-top:6px;text-align:center;font-size:14px}
.pron{margin-top:4px;color:#80e7ff;font-size:13px; text-align:center;}
.card-actions{display:flex;gap:6px;margin-top:10px; flex-wrap:wrap;}
.chip{font-size:12px;border-radius:8px;padding:6px 8px;border:1px solid rgba(148,163,184,.2);background:transparent;color:var(--text);cursor:pointer}
.status{margin-top:6px;font-size:13px;color:var(--muted);}
.wordCompare{display:flex;flex-wrap:wrap;gap:6px;margin-top:6px;font-size:13px;}
.wordCompare .ok{color:var(--ok);}
.wordCompare .err{color:var(--err);}
</style>
</head>
<body>
<main class="wrap">
<header>
  <h1>Dicion√°rio + Treino de Pron√∫ncia</h1>
  <p class="subtitle">Adicione e pratique frases em ingl√™s com tradu√ß√£o, pron√∫ncia e √°udio.</p>
</header>

<form id="addPhraseForm">
  <input type="text" id="engPhrase" placeholder="Frase em ingl√™s" required>
  <input type="text" id="ptPhrase" placeholder="Tradu√ß√£o" required>
  <input type="text" id="pronPhrase" placeholder="Pron√∫ncia (aprox.)">
  <button type="submit">Adicionar</button>
</form>

<section class="grid" id="phrases"></section>
</main>

<script>
let phrases = JSON.parse(localStorage.getItem('phrasesDictionary')) || [
  {w:'How are you?', t:'Como voc√™ est√°?', p:'r√°u √°r i√∫?'},
  {w:'Good morning', t:'Bom dia', p:'g√∫d m√≥orning'}
];

const container = document.getElementById('phrases');
const form = document.getElementById('addPhraseForm');

function render(){
  container.innerHTML = '';
  phrases.forEach((item,index)=>{
    const card = document.createElement('div');
    card.className='phrase-card';
    card.innerHTML = `
      <span>${item.w}</span>
      <small>${item.t}</small>
      <div class="pron">${item.p}</div>
      <div class="card-actions">
        <button class="chip speakBtn">üéôÔ∏è Falar</button>
        <button class="chip" onclick="speak('${escape(item.w)}')">Ouvir</button>
        <button class="chip" onclick="deletePhrase(${index})" style="background:#f87171;color:#0f172a;">Excluir</button>
      </div>
      <div class="status">‚Äî</div>
      <div class="wordCompare"></div>
    `;
    container.appendChild(card);

    const speakBtn = card.querySelector('.speakBtn');
    const statusEl = card.querySelector('.status');
    const wordCompareEl = card.querySelector('.wordCompare');

    speakBtn.onclick = ()=>{
      if(!('webkitSpeechRecognition' in window)){
        statusEl.textContent = 'Seu navegador n√£o suporta reconhecimento de voz';
        statusEl.style.color = '#ef4444';
        return;
      }
      const recognition = new webkitSpeechRecognition();
      recognition.lang = 'en-US';
      recognition.interimResults = false;
      recognition.maxAlternatives = 1;

      recognition.onstart = ()=>{ statusEl.textContent='Ouvindo... fale agora'; statusEl.style.color='#38bdf8'; }
      recognition.onerror = (e)=>{ statusEl.textContent='Erro: '+e.error; statusEl.style.color='#ef4444'; }
      recognition.onresult = (ev)=>{
        const spoken = ev.results[0][0].transcript;
        statusEl.textContent = `"${spoken}" ‚Üí "${item.w}"`;
        const correct = normalizeText(spoken) === normalizeText(item.w);
        statusEl.style.color = correct ? '#16a34a' : '#ef4444';
        renderWordComparison(normalizeText(item.w), normalizeText(spoken), wordCompareEl);
      }
      recognition.start();
    }
  });
}

function renderWordComparison(expected, spoken, container){
  container.innerHTML = '';
  const expWords = expected.split(' ').filter(Boolean);
  const spWords = spoken.split(' ').filter(Boolean);
  for(let i=0;i<expWords.length;i++){
    const exp = expWords[i];
    const sp = spWords[i] || '';
    const correct = levenshtein(exp, sp)/Math.max(exp.length, sp.length) <= 0.4;
    const div = document.createElement('div');
    div.textContent = sp+' ‚Üí '+exp;
    div.className = correct ? 'ok' : 'err';
    container.appendChild(div);
  }
}

function deletePhrase(index){
  if(confirm('Deseja realmente excluir esta frase?')){
    phrases.splice(index,1);
    localStorage.setItem('phrasesDictionary',JSON.stringify(phrases));
    render();
  }
}

function escape(s){ return s.replace(/\\/g,'\\\\').replace(/'/g,"\\'"); }

function speak(text){
  if('speechSynthesis' in window){
    const u = new SpeechSynthesisUtterance(text);
    u.lang = 'en-US';
    window.speechSynthesis.cancel();
    window.speechSynthesis.speak(u);
  } else alert('TTS n√£o dispon√≠vel no seu navegador.');
}

form.onsubmit = function(e){
  e.preventDefault();
  const w = document.getElementById('engPhrase').value.trim();
  const t = document.getElementById('ptPhrase').value.trim();
  const p = document.getElementById('pronPhrase').value.trim();
  if(w && t){
    phrases.push({w,t,p});
    localStorage.setItem('phrasesDictionary', JSON.stringify(phrases));
    render();
    form.reset();
  }
}

render();

/* helpers */
function normalizeText(s){
  return s.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'').replace(/[.,!?;:]/g,'').trim();
}

function levenshtein(a,b){
  if(a===b) return 0;
  const al=a.length, bl=b.length;
  if(al===0) return bl;
  if(bl===0) return al;
  let v0=new Array(bl+1),v1=new Array(bl+1);
  for(let j=0;j<=bl;j++) v0[j]=j;
  for(let i=0;i<al;i++){
    v1[0]=i+1;
    for(let j=0;j<bl;j++){
      const cost=a[i]===b[j]?0:1;
      v1[j+1]=Math.min(v1[j]+1, v0[j+1]+1, v0[j]+cost);
    }
    [v0,v1]=[v1,v0];
  }
  return v0[bl];
}
</script>
</body>
</html>
